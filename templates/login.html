{% extends "base.html" %}

{% block title %}Login - NetGuardian{% endblock %}

{% block content %}
<!-- Animated Background -->
<div class="login-background"></div>
<div class="grid-overlay"></div>

<div class="row justify-content-center align-items-center" style="min-height: 80vh;">
    <div class="col-md-5 col-lg-4">
        <div class="text-center mb-4 icon-pulse">
            <h1 class="fw-bold mb-3" style="color: var(--text-primary); text-shadow: 0 0 20px rgba(59, 130, 246, 0.5);">
                <span class="shield-icon me-2"><i class="bi bi-shield-lock-fill"></i></span>
                NetGuardian
            </h1>
            <p class="text-secondary" style="letter-spacing: 2px;">SECURE ANALYSIS PLATFORM</p>
        </div>

        <div class="card cyber-card">
            <div class="card-header bg-transparent border-bottom border-secondary pt-3 pb-0">
                <ul class="nav nav-tabs card-header-tabs w-100" id="authTab" role="tablist">
                    <li class="nav-item flex-fill text-center" role="presentation">
                        <button class="nav-link active w-100" id="login-tab" data-bs-toggle="tab"
                            data-bs-target="#login" type="button" role="tab" aria-controls="login" aria-selected="true">
                            <i class="bi bi-box-arrow-in-right me-2"></i>Login
                        </button>
                    </li>
                    <li class="nav-item flex-fill text-center" role="presentation">
                        <button class="nav-link w-100" id="register-tab" data-bs-toggle="tab" data-bs-target="#register"
                            type="button" role="tab" aria-controls="register" aria-selected="false">
                            <i class="bi bi-person-plus me-2"></i>Register
                        </button>
                    </li>
                </ul>
            </div>

            <div class="card-body p-4">
                <div class="tab-content" id="authTabContent">
                    <!-- Login Form -->
                    <div class="tab-pane fade show active" id="login" role="tabpanel" aria-labelledby="login-tab">
                        <form action="{{ url_for('login') }}" method="POST">
                            <div class="mb-3">
                                <label for="login-username" class="form-label text-secondary">Username</label>
                                <div class="input-group cyber-input-group">
                                    <span class="input-group-text"><i class="bi bi-person"></i></span>
                                    <input type="text" class="form-control cyber-input" id="login-username"
                                        name="username" required placeholder="Enter username">
                                </div>
                            </div>
                            <div class="mb-4">
                                <label for="login-password" class="form-label text-secondary">Password</label>
                                <div class="input-group cyber-input-group">
                                    <span class="input-group-text"><i class="bi bi-lock"></i></span>
                                    <input type="password" class="form-control cyber-input" id="login-password"
                                        name="password" required placeholder="Enter password">
                                </div>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-cyber">
                                    <i class="bi bi-check-lg me-2"></i>Sign In
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Register Form -->
                    <div class="tab-pane fade" id="register" role="tabpanel" aria-labelledby="register-tab">
                        <form action="{{ url_for('register') }}" method="POST">
                            <div class="mb-3">
                                <label for="register-username" class="form-label text-secondary">Username</label>
                                <div class="input-group cyber-input-group">
                                    <span class="input-group-text"><i class="bi bi-person"></i></span>
                                    <input type="text" class="form-control cyber-input" id="register-username"
                                        name="username" required placeholder="Choose a username">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="register-password" class="form-label text-secondary">Password</label>
                                <div class="input-group cyber-input-group">
                                    <span class="input-group-text"><i class="bi bi-lock"></i></span>
                                    <input type="password" class="form-control cyber-input" id="register-password"
                                        name="password" required placeholder="Choose a strong password">
                                </div>
                                <!-- Password Strength Meter -->
                                <div class="password-meter">
                                    <div class="meter-bar" id="password-strength-bar"></div>
                                </div>
                                <div class="meter-text" id="password-feedback"></div>
                            </div>
                            <div class="mb-4">
                                <label for="confirm-password" class="form-label text-secondary">Confirm Password</label>
                                <div class="input-group cyber-input-group">
                                    <span class="input-group-text"><i class="bi bi-lock-check"></i></span>
                                    <input type="password" class="form-control cyber-input" id="confirm-password"
                                        name="confirm_password" required placeholder="Confirm password">
                                </div>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-outline-cyber">
                                    <i class="bi bi-person-plus-fill me-2"></i>Create Account
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            <div class="card-footer bg-transparent border-top border-secondary p-3">
                {% for category, message in messages %}
                <div class="alert alert-{{ category }} mb-0 text-center py-2 fade show" role="alert">
                    {% if category == 'danger' %}
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                    {% elif category == 'success' %}
                    <i class="bi bi-check-circle-fill me-2"></i>
                    {% endif %}
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% endwith %}
        </div>

        <div class="text-center mt-4 text-muted small">
            &copy; 2026 NetGuardian Security. Authorized Access Only.
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const passwordInput = document.getElementById('register-password');
        const strengthBar = document.getElementById('password-strength-bar');
        const feedbackText = document.getElementById('password-feedback');

        passwordInput.addEventListener('input', function () {
            const password = this.value;
            const result = checkStrength(password);

            // Update bar width
            strengthBar.style.width = `${result.score * 25}%`; // 0 to 4 => 0% to 100%

            // Update bar color and text
            strengthBar.className = 'meter-bar'; // Reset class
            feedbackText.style.color = 'var(--text-muted)';

            if (password.length === 0) {
                strengthBar.style.width = '0%';
                feedbackText.textContent = '';
                return;
            }

            if (result.score <= 1) {
                strengthBar.classList.add('strength-weak');
                feedbackText.textContent = 'Weak: ' + result.feedback;
                feedbackText.style.color = 'var(--accent-danger)';
            } else if (result.score === 2) {
                strengthBar.classList.add('strength-medium');
                feedbackText.textContent = 'Medium: ' + result.feedback;
                feedbackText.style.color = 'var(--accent-warning)';
            } else if (result.score === 3) {
                strengthBar.classList.add('strength-strong');
                feedbackText.textContent = 'Strong';
                feedbackText.style.color = 'var(--accent-success)';
            } else {
                strengthBar.classList.add('strength-cyber');
                feedbackText.textContent = 'Very Strong (Cyber Secure)';
                feedbackText.style.color = 'var(--accent-primary)';
            }
        });

        function checkStrength(password) {
            let score = 0;
            let feedback = "";

            if (password.length < 8) {
                return { score: 0, feedback: "Too short (min 8 chars)" };
            }
            score++; // Length check passed

            if (/[A-Z]/.test(password)) score++; // Uppercase
            if (/[0-9]/.test(password)) score++; // Numbers
            if (/[^A-Za-z0-9]/.test(password)) score++; // Special chars

            if (score === 1) feedback = "Add numbers and symbols";
            if (score === 2) feedback = "Add special characters";
            if (score === 3) feedback = "Good, but could be stronger";

            return { score: score, feedback: feedback };
        }
    });
</script>
{% endblock %}